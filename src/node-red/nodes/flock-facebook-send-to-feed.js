
  /**
   * AUTOGENERATED. DO NOT CHANGE.
   */

  const axios = require('axios');
  var handlebars = require('handlebars');
  var handlebarHepers = require('handlebars-helpers')({
    handlebars: handlebars
  });

  module.exports = function(RED) {
    function FacebookSendtoFeedNode(config) {
      RED.nodes.createNode(this, config);
      var node = this;

      node.on('input', function(msg) {
        // Retrieve the config node
        node.server = RED.nodes.getNode(config.server);
        if (!node.server) return node.error("Missing Flock config");

        const host = node.server.host
        const apiKey = node.server.key
        const url = host + '/facebook/feed/send?apikey=' + apiKey

        // Parse any params
        var facebookAccessToken = config.facebookAccessToken.indexOf("{{") != -1 ? handlebars.compile(config.facebookAccessToken)(msg) : config.facebookAccessToken
        var facebookVerifyToken = config.facebookVerifyToken.indexOf("{{") != -1 ? handlebars.compile(config.facebookVerifyToken)(msg) : config.facebookVerifyToken
        var facebookAppSecret = config.facebookAppSecret.indexOf("{{") != -1 ? handlebars.compile(config.facebookAppSecret)(msg) : config.facebookAppSecret
        var feedId = config.feedId.indexOf("{{") != -1 ? handlebars.compile(config.feedId)(msg) : config.feedId
        var message = config.message.indexOf("{{") != -1 ? handlebars.compile(config.message)(msg) : config.message

        // Send the message
        axios.post(url, {
            config: {
              facebookAccessToken,
              facebookVerifyToken,
              facebookAppSecret
            },
            payload: {
              feedId,
              message
            }
          })
          .then(function(result) {
            node.log(result.data);
          })
          .catch(function(error) {
            node.error(error);
            node.error(error.response.data);
          })
        
        node.send(msg);
      });
    }
    RED.nodes.registerType("flock-facebook-send-to-feed", FacebookSendtoFeedNode);
  }
  